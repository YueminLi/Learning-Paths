---
title: "Lab 7-Non-Linear Modeling"
output: html_document
---

# Packages and library
```{r}
install.packages('ISLR')
```

```{r}
library(ISLR)
attach(Wage)
```

# Polynomial Regression and Step Functions

```{r}
# orthogonal polynomial, reduce collinearity
fit = lm(wage ~ poly(age, 4), data=Wage)
coef(summary(fit))

# raw polynomial
fit2 = lm(wage ~ poly(age, 4, raw=TRUE), data=Wage)
coef(summary(fit2))

# similar methods to fit raw polynomial model
fit2a = lm(wage ~ age + I(age^2) + I(age^3) + I(age^4), data=Wage)
coef(fit2a)

fit2b = lm(wage ~ cbind(age, age^2, age^3, age^4), data=Wage)
coef(fit2b)

# create a grid of values for age at which we want predictions
agelims = range(age)
age.grid = seq(from=agelims[1], to=agelims[2])
# obtain predictions and standard error
preds = predict(fit, newdata=list(age=age.grid), se=TRUE)
se.bands = cbind(preds$fit + 2*preds$se.fit, preds$fit - 2*preds$se.fit)

# plot the data
par(mfrow=c(1,2), mar=c(4.5, 4.5, 1, 1), oma=c(0, 0, 4, 0))
plot(age, wage, xlim=agelims, cex=.5, col="darkgrey")
title("Degree -4 Polynomial", outer=TRUE)
lines(age.grid, preds$fit, lwd=2, col="blue")
matlines(age.grid, se.bands, lwd=1, col="blue", lty=3)

# decide on the degree of the polynomial using ANOVA
# null hypothesis: a model M1 is sufficient to explain the data
# alternative hypothesis: a more complex model M2 is required
# M1 and M2 must be nested models: the predictors in M1 must be a subset of the predictors in M2
fit.1 = lm(wage ~ age, data=Wage)
fit.2 = lm(wage ~ poly(age, 2), data=Wage)
fit.3 = lm(wage ~ poly(age, 3), data=Wage)
fit.4 = lm(wage ~ poly(age, 4), data=Wage)
fit.5 = lm(wage ~ poly(age, 5), data=Wage)
anova(fit.1, fit.2, fit.3, fit.4, fit.5)

# poly() creates the same p-value as in ANOVA
coef(summary(fit.5))

# predict whether an individual earns more than $250,000 per year
fit = glm(I(wage>250) ~ poly(age, 4), data=Wage, family=binomial)
preds = predict(fit, newdata=list(age=age.grid), se=TRUE)
```
